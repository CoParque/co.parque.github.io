<!DOCTYPE html>
<html>

<head>
	<title>Informe de predicación telefónica</title>
	<meta name="robots" content="noindex" />
	<meta name="robots" content="nofollow" />
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="/favicon.ico">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/jsonata@1.6.4/jsonata.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
	<link href="/app/css/bootstrap.min.css" rel="stylesheet">
	<script>
      /*
	$(window).on('message',function(e){
	alert('Mensaje del iframe');
	console.log("MESSAGE",e);
		
	});
	
	$(document).on('click', 'a[rel=modal]', function(e) {
		e.stopImmediatePropagation();
		e.preventDefault();
		var modal = $('#modal').modal();
		console.log('hey')
		modal.find('.modal-body').load($(this).attr('href'), function(responseText, textStatus) {
			if(textStatus === 'success' || textStatus === 'notmodified') {
				$('#miframe').attr('src',"detalle.html?telefono=(343)%20424%20-%200288")
				modal.show();
			}
		});
	});*/
	var $table = $('#table');
	function loadJson() {
		$('#cargando').modal('show');
        
		$.getJSON('https://sheets.googleapis.com/v4/spreadsheets/1VGOPLJ19ms7Xi1NyLFE83cjAkq3OrffrwRjjxgcgSQ4/values/telefonos?alt=json&key=AIzaSyCz4sutc6Z6Hh5FtBTB53I8-ljkj6XWpPc').done(function(jsonurl) {
			var data = jsonata('$.values.({"Telefono":$[0], "Direccion":$[1], "Localidad":$[2], "Fecha":$[3], "Respuesta":$[4], "Publicador":$[5], "Turno":$[6], "Observaciones":$[7]})').evaluate(jsonurl);
			console.log(data);
			$('#table').bootstrapTable({
				data: data
			});
			$('#table').bootstrapTable('load', data);
			$('#cargando').modal('hide');
		});
	};
      loadJson();
var win;
	function LinkFormatter(value, row, index) {
		return "<a href='javascript:win = window.open(&apos;detalle.html?telefono=" + value + "&apos;);'>" + value + "</a>";
	};
      window.addEventListener('message', event => {
  // Only accept messages from http://example.com.
  if (event.origin === 'https://churruar.in') {
    win.close()
    loadJson();
  }
});
      
      
	</script>
</head>

<body role="document">

	<div class="container">
      <ul class="nav nav-tabs">
  <li role="presentation" class="active"><a href="#">Paraná</a></li>
  <li role="presentation"><a href="#">Interior</a></li>
</ul>
      <div class="btn-group" role="group" aria-label="...">
  <button type="button" class="btn btn-default">Contactos</button>
  <button type="button" class="btn btn-default">Reservas</button>

</div>
      

		<h1>Territorio para predicación telefónica</h1>
		<div class="table-responsive">
			<table id="table" data-toggle="table" class="table table-striped">
				<thead>
					<tr>
						<th data-field="Telefono" data-formatter="LinkFormatter">Teléfono</th>
						<th data-field="Direccion">Dirección</th>
						<th data-field="Respuesta">Última respuesta</th>
					</tr>
				</thead>
			</table>
		</div>
	</div>

	<div class="modal fade" id="cargando" tabindex="-1" role="dialog">
      <p>Cargando...</p>
	</div>
	<!-- /.modal -->
</body>

</html>
