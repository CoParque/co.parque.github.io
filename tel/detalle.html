<!DOCTYPE html>
<html>

<head>
	<title>Territorio para predicación telefónica</title>
	<meta name="robots" content="noindex" />
	<meta name="robots" content="nofollow" />
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="/favicon.ico">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/jsonata@1.6.4/jsonata.min.js"></script>
	<link href="/app/css/bootstrap.min.css" rel="stylesheet">
	<script>
		
/*
	$(document).on('click','#parent-window-msg',function(){
	alert('Enviando evento a la ventana padre');
	parent.postMessage("eventoiframe", "*")
	
	});*/
		
	var getUrlParameter = function getUrlParameter(sParam) {
		var sPageURL = window.location.search.substring(1),
			sURLVariables = sPageURL.split('&'),
			sParameterName,
			i;
		for(i = 0; i < sURLVariables.length; i++) {
			sParameterName = sURLVariables[i].split('=');
			if(sParameterName[0] === sParam) {
				return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
			}
		}
	};
	var telefono = getUrlParameter('telefono');
	var registrotel;
	console.log(telefono);
	$(function() {
		$('#cargando').modal('show');
		$.getJSON('https://sheets.googleapis.com/v4/spreadsheets/1VGOPLJ19ms7Xi1NyLFE83cjAkq3OrffrwRjjxgcgSQ4/values/telefonos?alt=json&key=AIzaSyCz4sutc6Z6Hh5FtBTB53I8-ljkj6XWpPc').done(function(jsonurl) {
			var data = jsonata('$.values.({"Telefono":$[0], "Direccion":$[1], "Localidad":$[2], "Respuesta":$[3], "Publicador":$[4], "Fecha":$[5], "Turno":$[6], "Observaciones":$[7]})').evaluate(jsonurl);
			registrotel = jsonata('$[Telefono="' + telefono + '"]').evaluate(data);
			console.log(registrotel);
			$("#Telefono").text(registrotel['Telefono']);
			$("#Direccion").text(registrotel['Direccion']);
			$("#Localidad").text(registrotel['Localidad']);
			$("#Fecha").text(registrotel['Fecha']);
			$("#Respuesta").text(registrotel['Estado']);
			$("#Observaciones").text(registrotel['Observaciones']);
			$("#informar").attr("href", "informar.html?telefono=" + registrotel['Telefono']);
           $("#reservar").attr("href", "reservar.html?telefono=" + registrotel['Telefono']);
			$('#cargando').modal('hide');
		});
	});
      
          $("#cancelar").click(function(){
    window.opener.postMessage('close', '//churruar.in')
});
	</script>
</head>


	<body role="document">
      
      
	<div class="container">
      <h1>Contacto para predicación telefónica</h1>
		<dl class="dl-horizontal">
          			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Datos del contacto</h3> </div>
          <div class="panel-body"><dt>Teléfono</dt>
			<dd id="Telefono">...</dd> <dt>Dirección</dt>
			<dd id="Direccion">...</dd> <dt>Localidad</dt>
            <dd id="Localidad">...</dd></div></div>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Último llamado</h3> </div>
				<div class="panel-body"> <dt>Fecha</dt>
					<dd id="Fecha">...</dd> <dt>Respuesta</dt>
					<dd id="Estado">...</dd> <dt>Observaciones</dt>
					<dd id="Observaciones">...</dd>
				</div>
			</div>
		</dl>
	 <p class="text-right">
	
	 <a class="btn btn-info"  id="reservar" href="#" role="button">Reservar</a> 
      <a class="btn btn-warning" id="informar" href="#" role="button">Informar llamado</a>
       <button class="btn btn-default" id="cancelar">Cancelar</button></p>
      </div>
  
	<div class="modal fade" id="cargando" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-body">
					<h3 class="text-center">Cargando...</h3> </div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<!-- /.modal -->
</body>

</html>
